# This is a Databricks asset bundle definition for ncpdp.
# See https://docs.databricks.com/dev-tools/bundles/index.html for documentation.
bundle:
  name: ncpdp
  uuid: 6b809732-60d7-4af7-b6d5-5bf169857db6

include:
  - resources/*.yml
  - resources/*/*.yml

# Variable declarations. These variables are assigned in the dev/prod targets below.
variables:
  catalog:
    description: The catalog to use
  schema:
    description: The schema to use
  volume:
    description: The name of the volume to use for autoloading files
    default: landing
  event_log_catalog:
    description: The catalog to publish the ETL Pipeline's event log.
  event_log_schema:
    description: The schema to publish the ETL Pipeline's event log. 
  serverless_environment_version: 
    default: "4"
    description: The Serverless Environment version to use with serverless workflows.  
  run_as_user:
    default: "matthew.giglia@databricks.com"
    description: The principal the workflow and pipelines should run as.  

targets:
  dev:
    # The default target uses 'mode: development' to create a development copy.
    # - Deployed resources get prefixed with '[dev my_user_name]'
    # - Any job schedules and triggers are paused by default.
    # See also https://docs.databricks.com/dev-tools/bundles/deployment-modes.html.
    mode: development
    default: true
    workspace:
      host: https://dbc-e5684c0a-20fa.cloud.databricks.com
    variables:
      catalog: dev
      schema: ncpdp
      event_log_catalog: ${var.catalog}
      event_log_schema: ${resources.schemas.ncpdp_schema.name}


  prod:
    mode: production
    workspace:
      host: https://dbc-e5684c0a-20fa.cloud.databricks.com
      # We explicitly deploy to /Workspace/Users/${var.run_as_user} to make sure we only have a single copy. 
      root_path: /Workspace/Users/${var.run_as_user}/.bundle/${bundle.name}/${bundle.target}
    variables:
      catalog: prod
      schema: ncpdp
      event_log_catalog: ${var.catalog}
      event_log_schema: ${resources.schemas.ncpdp_schema.name}
    permissions:
      - user_name: ${var.run_as_user}
        level: CAN_MANAGE
